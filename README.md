# Лабораторная работа №4 – Средства постэксплуатации

**Дисциплина:** Защита ПО в защищённых АС  
**Выполнили:** Кашников Андрей, Политыко Артём, Тоцкая Марина  
**Группа:** 21-КАС-2

## Фреймворк постэксплуатации Empire

Empire — это фреймворк для постэксплуатации и эмуляции действий противника, используемый для помощи RedTeam-командам и специалистам по пентесту. Сервер Empire написан на Python 3 и имеет модульную структуру, обеспечивающую гибкость для пользователя. Empire поставляется со встроенным клиентом, который можно использовать для удаленного доступа к серверу. Также доступен графический интерфейс пользователя для удаленного доступа к серверу Empire — Starkiller.

Установленный и запущенный сервер Empire:
![картинко](https://github.com/Eadarinel/zpozas-lr4/blob/main/lr4_img/1.png)

Empire разворачивает веб-интерфейс Starkiller, доступный из браузера в качестве замены CLI-интерфейса Empire:
![картинко](https://github.com/Eadarinel/zpozas-lr4/blob/main/lr4_img/2.png)

Ключевые компоненты:
1. Listener – служба, локально запускающая прослушивание трафика по заданному порту. Необходима для связи заражённого хоста с CnC сервером.
2. Stager – скомпилированная программа или скрипт, которую необходимо доставить на хост, который является целью для эксплуатации, чтобы инициализировать и закрепить сетевое соединение с CnC-сервером.
3. Agent – хост, установивший соединение с CnC-сервером, доступный для эксплуатации.
4. Module – готовые исполнения техник эксплуатаций, запускаемые на агентах.
Дополнительно Empire хранит аутентификационные данные (Credentials), которые были найдены в ходе эксплуатации хостов, либо добавлены пользователем вручную.

Был создан Listener, прослушивающий HTTP-трафик по порту 80:
![картинко](https://github.com/Eadarinel/zpozas-lr4/blob/main/lr4_img/3.png)

Был создан Stager, который является bash-скриптом, который запускает Python-скрипт, который десериализует base64-строку внутри себя и запускает отдельным процессом. В нём содержится другой Python-скрипт, инициализирующий соединение с CnC-сервером.
![картинко](https://github.com/Eadarinel/zpozas-lr4/blob/main/lr4_img/4.png)

Вредоносный скрипт был доставлен на хост на другой виртуальной машине (сервер и хост находятся в одной подсети) и запущен.
![картинко](https://github.com/Eadarinel/zpozas-lr4/blob/main/lr4_img/5.png)

Видно, что агент стал активен (красным выделен неактивный агент, который тестировался изначально):
![картинко](https://github.com/Eadarinel/zpozas-lr4/blob/main/lr4_img/6.png)

При переходе на активный агент, открывается страница, позволяющая удалённо управлять хостом.
Раздел, позволяющий удалённо выполнять команды терминала:
![картинко](https://github.com/Eadarinel/zpozas-lr4/blob/main/lr4_img/7.png)

Раздел, сканирующий файловую систему:
![картинко](https://github.com/Eadarinel/zpozas-lr4/blob/main/lr4_img/8.png)

Пример запуска команды удалённо (была запущена команда ip a, выводящая список сетевых адаптеров и их настроек):
![картинко](https://github.com/Eadarinel/zpozas-lr4/blob/main/lr4_img/9.png)
